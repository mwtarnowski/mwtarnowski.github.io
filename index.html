<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="favicon.ico" sizes="any">
  <link rel="icon" href="favicon.svg" type="image/svg+xml" sizes="any">
  <link rel="stylesheet" href="style.css">
  <title>test</title>
</head>

<body>

  <div id="bit-container">
    <!-- bit-cell elements here -->
  </div>

  <div class="hline"></div>

  <div id="values-section">
    <div class="input-group">
      <label for="input0">Jumbo:</label>
      <div class="input-wrapper">
        <input type="text" id="input0" readonly>
      </div>
    </div>

    <div class="input-group">
      <label for="input1">Vox:</label>
      <div class="input-wrapper">
        <input type="text" id="input1">
        <div class="buttons">
          <button type="button">−</button>
          <button type="button">+</button>
        </div>
      </div>
    </div>

    <div class="input-group">
      <label for="input2">Buzzbomb:</label>
      <div class="input-wrapper">
        <input type="text" id="input2">
        <div class="buttons">
          <button type="button">−</button>
          <button type="button">+</button>
        </div>
      </div>
    </div>

    <div class="hline"></div>
    <div class="hline"></div>

    <div>
      <input type="number" id="size-input">
      <button type="button" id="size-submit">BEEP</button>
    </div>

  </div>

  <script>
    let totalBits = 29;
    let bitPattern = [];

    function createBitFields() {
      const padBits = Math.ceil(totalBits / 8) * 8;
      bitPattern = new Array(padBits).fill(0); // initialize array

      const bits = [];
      for (let index = padBits - 1; index >= 0; index--) {
        const isValid = index < totalBits;

        const bitCell = document.createElement('div');
        bitCell.classList.add('bit-cell');

        const bitIndex = document.createElement('div');
        bitIndex.classList.add('bit-index');
        bitIndex.textContent = index.toString().padStart(2, '0');
        bitCell.appendChild(bitIndex);

        const bitField = document.createElement('div');
        bitField.classList.add('bit-field');
        bitField.dataset.index = index;
        if (isValid) {
          bitField.classList.add('part');
          bitField.dataset.value = '0'; // store initial value
          bitField.textContent = '0';
          bitField.tabIndex = 0;
        } else {
          bitField.classList.add('empty');
          bitField.dataset.value = ''; // no value
        }
        bitCell.appendChild(bitField);

        bits.push(bitCell);
      }

      const bytesFragment = document.createDocumentFragment();
      for (let i = 0; i < bits.length; i += 8) {
        const byte = document.createElement('div');
        byte.className = 'byte';
        bits.slice(i, i + 8).forEach(bit => byte.appendChild(bit));
        bytesFragment.appendChild(byte);
      }

      const bitContainer = document.getElementById('bit-container');
      // bitContainer.innerHTML = '';
      const newContainer = bitContainer.cloneNode(false);
      bitContainer.parentNode.replaceChild(newContainer, bitContainer);

      newContainer.appendChild(bytesFragment);

      const isBitField = (elem) => elem.classList.contains('bit-field') && !elem.classList.contains('empty');

      newContainer.addEventListener('click', (e) => {
        if (!isBitField(e.target)) return;
        toggleBit(e.target);
      });

      newContainer.addEventListener('keydown', (e) => {
        if (e.key === ' ' || e.key === 'Enter') {
          if (!isBitField(e.target)) return;
          e.preventDefault();
          toggleBit(e.target);
        }
      });

    }

    function toggleBit(bitElement) {
      const index = Number(bitElement.dataset.index);
      let currentValue = Number(bitElement.dataset.value);
      let newValue = 1 - currentValue;
      bitElement.dataset.value = newValue.toString();
      bitElement.textContent = newValue.toString();
      bitPattern[index] = newValue;
    }

    function reload(size) {
      if (!size) return;
      if (size <= 0) return;
      totalBits = size;
      createBitFields();
    }

    const sizeInput = document.getElementById('size-input');
    const sizeSubmit = document.getElementById('size-submit');
    sizeSubmit.onclick = () => reload(Number(sizeInput.value));

    reload(29);
  </script>

</body>

</html>

